{"ast":null,"code":"\"use strict\";\n/**\n * Copyright 2018 Google LLC\n *\n * Distributed under MIT license.\n * See file LICENSE for detail or copy at https://opensource.org/licenses/MIT\n */\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar fs = require(\"fs\");\n\nvar forge = require(\"node-forge\");\n\nvar pify = require(\"pify\");\n\nvar readFile = pify(fs.readFile);\n\nfunction getPem(filename, callback) {\n  if (callback) {\n    getPemAsync(filename).then(function (pem) {\n      return callback(null, pem);\n    }).catch(function (err) {\n      return callback(err, null);\n    });\n  } else {\n    return getPemAsync(filename);\n  }\n}\n\nexports.getPem = getPem;\n\nfunction getPemAsync(filename) {\n  return readFile(filename, {\n    encoding: 'base64'\n  }).then(function (keyp12) {\n    return convertToPem(keyp12);\n  });\n}\n/**\n * Converts a P12 in base64 encoding to a pem.\n * @param p12base64 String containing base64 encoded p12.\n * @returns a string containing the pem.\n */\n\n\nfunction convertToPem(p12base64) {\n  var p12Der = forge.util.decode64(p12base64);\n  var p12Asn1 = forge.asn1.fromDer(p12Der);\n  var p12 = forge.pkcs12.pkcs12FromAsn1(p12Asn1, 'notasecret');\n  var bags = p12.getBags({\n    friendlyName: 'privatekey'\n  });\n\n  if (bags.friendlyName) {\n    var privateKey = bags.friendlyName[0].key;\n    var pem = forge.pki.privateKeyToPem(privateKey);\n    return pem.replace(/\\r\\n/g, '\\n');\n  } else {\n    throw new Error('Unable to get friendly name.');\n  }\n}","map":null,"metadata":{},"sourceType":"script"}